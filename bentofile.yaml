service: "src.predict:FluxLoRAService"
description: "A blazing-fast inference stack for Flux.1-dev with dynamic LoRA hotswapping."

include:
  - "predict.py"

secrets:
  - hugging-face-1

exclude:
  - "*.pyc"
  - "__pycache__/"

labels:
  owner: "Parag Ekbote"
  stage: "not-ready"

python:
  packages:
    - "pillow>=10.3.0"
    - "transformers>=4.52.0"
    - "accelerate>=1.8.0"
    - "diffusers>=0.33.0"
    - "bitsandbytes>=0.45.0"
    - "huggingface-hub[hf-xet]"
    - "peft>=0.15.0"
    - "gradio"
    - "sentencepiece>=0.1.95"
    - "protobuf>=3.20.0"
    - "torch>=2.2.0"
    - "torchvision"
    - "torchaudio"
    - "psutil"

docker:
  base_image: "pytorch/pytorch:2.1.0-cuda12.1-cudnn8-devel"

services:
  flux_lora_service:
    instance_type: gpu.l4.1
    scaling:
      min_replicas: 0
      max_replicas: 1
    envs:
      - name: HF_TOKEN
